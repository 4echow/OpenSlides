<div class="header">
  <div class="title">
    <div class="submenu">
      <a  ng-click="openDialog()" os-perms="mediafiles.can_upload" class="btn btn-primary btn-sm">
        <i class="fa fa-plus fa-lg"></i>
        <translate>New</translate>
      </a>
    </div>
    <h1 translate>Files</h1>
  </div>
</div>

<!-- mediafile pdf controls -->
<div os-perms-lite="core.can_manage_projector" ng-if="presentedMediafiles.length">

  <div ng-repeat="presentedMediafile in presentedMediafiles">
    <h3 translate>PDF controls</h3>
    <nav ng-class="getNavStyle(scroll)">
      <button ng-click="mediafileGoPrevious()"><</span></button>
      <button ng-click="mediafileGoNext()">></span></button>

      <button ng-click="mediafileZoomIn()">+</span></button>
      <button ng-click="mediafileFit()">100%</span></button>
      <button ng-click="mediafileZoomOut()">-</span></button>

      <span>Page: </span>
      <input type="text" min=1 ng-model="presentedMediafile.page">
      <span> / {{presentedMediafile.numPages}}</span>

    </nav>
  </div>
</div>

<div class="details">
  <div class="row form-group">
    <div class="col-sm-6">
      <form class="form-inline">
        <!-- delete mode -->
        <button os-perms="mediafiles.can_manage" class="btn"
            ng-class="$parent.isDeleteMode ? 'btn-primary' : 'btn-default'"
            ng-click="$parent.isDeleteMode = !$parent.isDeleteMode; uncheckAll()">
          <i class="fa fa-check-square-o"></i>
          <translate>Select ...</translate>
        </button>
      </form>
    </div>
    <div class="col-sm-6">
      <div class="form-inline text-right">
        <div class="form-group">
          <div class="input-group">
            <div class="input-group-addon"><i class="fa fa-search"></i></div>
            <input type="text" os-focus-me ng-model="filter.search" class="form-control"
               placeholder="{{ 'Search' | translate}}">
          </div>
        </div>
        <button class="btn btn-default" ng-click="isFilterOpen = !isFilterOpen"
            ng-class="isFilterOpen ? 'btn-primary' : 'btn-default'">
          <i class="fa fa-filter"></i>
          <translate>Filter ...</translate>
        </button>
      </div>
    </div>
  </div>
  <div uib-collapse="!isFilterOpen" class="row">
    <div class="col-sm-6 text-right"></div>
    <div class="col-sm-6 text-right">
      <!-- pdf filter -->
      <input type="checkbox" ng-model="filter.showPDFs" ng-true-value="'application/pdf'" ng-false-value=''>
      <translate> Show PDF files only</translate>
    </div>
  </div>
  <div uib-collapse="!isDeleteMode" class="row spacer">
    <div class="col-sm-12 text-left">
      <!-- delete button -->
      <a ng-show="isDeleteMode"
          os-perms="mediafiles.can_manage" ng-click="deleteMultiple()"
          class="btn btn-primary">
        <i class="fa fa-trash fa-lg"></i>
        <translate>Delete selected mediafiles</translate>
      </a>
    </div>
  </div>

  <div class="spacer-top-lg italic">
    {{ mediafilesFiltered.length }} /
    {{ mediafiles.length }} {{ "files" | translate }}<span ng-if="(mediafiles|filter:{selected:true}).length > 0">,
    {{(mediafiles|filter:{selected:true}).length}} {{ "selected" | translate }}</span>
  </div>
  <table class="table table-striped table-bordered table-hover">
    <thead>
      <tr>
        <!-- projector column -->
        <th ng-show="!isDeleteMode" os-perms="core.can_manage_projector" class="minimum">
        <!-- delete selection column -->
        <th ng-show="isDeleteMode" os-perms="mediafiles.can_manage" class="minimum deleteColumn">
          <input type="checkbox" ng-model="$parent.selectedAll" ng-change="checkAll()">
        <!-- title -->
        <th ng-click="toggleSort('title_or_filename')" class="sortable">
          <translate>Title</translate>
          <i class="pull-right fa" ng-show="sortColumn === 'title_or_filename' && header.sortable != false"
              ng-class="reverse ? 'fa-sort-desc' : 'fa-sort-asc'">
          </i>
        <!-- filetype -->
        <th ng-click="toggleSort('filetype')" class="sortable optional">
          <translate>Filetype</translate>
          <i class="pull-right fa" ng-show="sortColumn === 'filetype' && header.sortable != false"
              ng-class="reverse ? 'fa-sort-desc' : 'fa-sort-asc'">
          </i>
        <!-- filesize -->
        <th ng-click="toggleSort('filesize')" class="sortable optional">
          <translate>Filesize</translate>
          <i class="pull-right fa" ng-show="sortColumn === 'filesize' && header.sortable != false"
              ng-class="reverse ? 'fa-sort-desc' : 'fa-sort-asc'">
          </i>
        <!-- upload time -->
        <th ng-click="toggleSort('timestamp')" class="sortable optional">
          <translate>Upload time</translate>
          <i class="pull-right fa" ng-show="sortColumn === 'timestamp' && header.sortable != false"
              ng-class="reverse ? 'fa-sort-desc' : 'fa-sort-asc'">
          </i>
        <!-- uploaded by -->
        <th ng-click="toggleSort('uploader')" class="sortable">
          <translate>Uploaded by</translate>
          <i class="pull-right fa" ng-show="sortColumn === 'uploader' && header.sortable != false"
              ng-class="reverse ? 'fa-sort-desc' : 'fa-sort-asc'">
          </i>
      </tr>
    <tbody>
      <tr ng-repeat="mediafile in mediafilesFiltered = (mediafiles | osFilter: filter.search : getFilterString |
          filter: {filetype: filter.showPDFs} | orderBy: sortColumn:reverse)"
          class="animate-item"
          ng-class="{ 'activeline': mediafile.isProjected(), 'selected': mediafile.selected }">
        <!-- projector column -->
        <!-- TOOD: implement project pdf feature -->
        <td ng-show="!isDeleteMode"
            os-perms="core.can_manage_projector">
          <a class="btn btn-default btn-sm"
              ng-if="mediafile.mediafile.type == 'application/pdf'"
              ng-class="{ 'btn-primary': mediafile.isProjected() }"
              ng-click="mediafile.project()"
              ng-bootbox-alert="{{ 'Sorry, the function to project pdf files is not yet implemented.' | translate }}"
              title="{{ 'Project mediafile' | translate }}">
            <i class="fa fa-video-camera"></i>
          </a>
        <!-- delete selection column -->
        <td ng-show="isDeleteMode" os-perms="mediafiles.can_manage" class="deleteColumn">
          <input type="checkbox" ng-model="mediafile.selected">
        <!-- mediafile data colums -->
        <td ng-mouseover="mediafile.hover=true" ng-mouseleave="mediafile.hover=false">
          <strong><a ng-href="{{ mediafile.mediafileUrl }}" target="_blank">{{ mediafile.title_or_filename }}</a></strong>
          <div os-perms="mediafiles.can_manage" class="hoverActions" ng-class="{'hiddenDiv': !mediafile.hover}">
            <a href="" ng-click="openDialog(mediafile)" translate>Edit</a> |
            <a href="" class="text-danger"
                ng-bootbox-confirm="{{ 'Are you sure you want to delete this file?' | translate }}<br>
                <b>{{ mediafile.title }} [{{ mediafile.mediafile.name }}]</b>"
                ng-bootbox-confirm-action="delete(mediafile)" translate>Delete</a>
          </div>
        <td class="optional">{{ mediafile.mediafile.type }}
        <td class="optional">{{ mediafile.filesize }}
        <td class="optional">{{ mediafile.timestamp | date:'yyyy-MM-dd HH:mm:ss' }}
        <td>{{ mediafile.uploader.get_full_name() }}
    </tbody>
  </table>
</div>
