<h1 translate>Participants</h1>

<div id="submenu">
  <div os-perms="users.can_manage" class="btn-group">
    <a ui-sref="users.user.create" class="btn btn-primary btn-sm">
      <i class="fa fa-user-plus fa-lg"></i>
      <translate>New</translate>
    </a>
    <button class="btn btn-primary btn-sm dropdown-toggle" data-toggle="dropdown">
      <span class="fa fa-caret-down"></span>
    </button>
    <ul class="dropdown-menu">
      <li><a ui-sref="users.user.create">
            <i class="fa fa-user fa-fw"></i>
            <translate>Single participant</translate>
          </a>
      <li><a href="#TODO">
            <i class="fa fa-group fa-fw"></i>
            <translate>Multiple participants</translate>
          </a>
    </ul>
  </div>
  <a ui-sref="users.group.list" os-perms="users.can_manage" class="btn btn-default btn-sm">
    <i class="fa fa-group fa-lg"></i>
    <translate>Groups</translate>
  </a>
  <a ui-sref="users.user.csv-import" os-perms="users.can_manage" class="btn btn-default btn-sm">
    <i class="fa fa-download fa-lg"></i>
    <translate>Import</translate>
  </a>
  <div class="btn-group">
    <!-- TODO: use ui-sref -->
    <a href="/users/print/" class="btn btn-default btn-sm" target="_blank">
      <i class="fa fa-file-pdf-o fa-lg"></i>
      <translate>PDF</translate>
    </a>
    <button os-perms="users.can_manage" class="btn btn-default btn-sm dropdown-toggle"
        data-toggle="dropdown">
      <i class="fa fa-caret-down"></i>
    </button>
    <ul class="dropdown-menu dropdown-menu-right">
      <!-- TODO: use ui-sref -->
      <li><a href="/users/print/" target="_blank">
            <i class="fa fa-list fa-fw"></i>
            <translate>List of participants</translate>
          </a>
      <li os-perms="users.can_manage">
          <a href="/users/passwords/print/" target="_blank">
            <i class="fa fa-qrcode fa-fw"></i>
            <translate>List of access data</translate>
          </a>
    </ul>
  </div>
</div>

<div class="row form-group">
  <div class="col-sm-8">
    <input type="checkbox" ng-model="filterPresent" ng-false-value="''">
    <translate>Is present</translate>
  </div>
  <div class="col-sm-4">
    <input type="text" os-focus-me ng-model="filter.search" class="form-control"
        placeholder="{{ 'Filter' | translate}}">
  </div>
</div>

<table class="table table-striped table-bordered table-hover">
  <thead>
    <tr>
      <th ng-click="sortby='is_present';reverse=!reverse">
        <translate>Present</translate>
        <i class="fa" ng-show="sortby == 'is_present'"
            ng-class="reverse ? 'fa-sort-desc' : 'fa-sort-asc'"></i>
      <th ng-click="sortby='first_name';reverse=!reverse">
        <translate>Name</translate>
        <i class="fa" ng-show="sortby == 'first_name'"
            ng-class="reverse ? 'fa-caret-down' : 'fa-caret-up'"></i>
      <th class="optional" ng-click="sortby='structure_level';reverse=!reverse">
        <translate>Structure level</translate>
        <i class="fa" ng-show="sortby == 'structure_level'"
            ng-class="reverse ? 'fa-caret-down' : 'fa-caret-up'"></i>
      <th class="optional" ng-click="sortby='groups';reverse=!reverse">
        <translate>Group</translate>
        <i class="fa" ng-show="sortby == 'groups'"
            ng-class="reverse ? 'fa-caret-down' : 'fa-caret-up'"></i>
      <th os-perms="users.can_manage" class="optional" ng-click="sortby='comment';reverse=!reverse">
        <translate>Comment</translate>
        <i class="fa" ng-show="sortby == 'comment'"
            ng-class="reverse ? 'fa-caret-down' : 'fa-caret-up'"></i>
      <th os-perms="users.can_manage" class="optional" ng-click="sortby='last_login';reverse=!reverse">
        <translate>Last Login</translate>
        <i class="fa" ng-show="sortby == 'last_login'"
            ng-class="reverse ? 'fa-caret-down' : 'fa-caret-up'"></i>
      <th os-perms="users.can_manage core.can_manage_projector" class="mini_width" translate>Actions</th>
  <tbody>
    <tr ng-repeat="user in users | filter: filter.search | filter: {is_present: filterPresent} |
        orderBy: sortby:reverse">
      <td><input type="checkbox" ng-model="user.is_present" ng-click="togglePresent(user)">
      <td><a ui-sref="users.user.detail({id: user.id})">{{ user.get_short_name() }}</a>
      <td class="optional">{{ user.structure_level }}
      <td class="optional">{{ user.groups }}
      <td os-perms="users.can_manage" class="optional">{{ user.comment }}
      <td os-perms="users.can_manage" class="optional">{{ user.last_login | date:'yyyy-MM-dd HH:mm:ss'}}
      <td os-perms="users.can_manage core.can_manage_projector" class="nobr">
        <!-- projector, TODO: add link to activate slidea-->
        <a href="#TODO" os-perms="core.can_manage_projector" class="btn btn-default btn-sm"
            title="{{ 'Show' | translate }}">
          <i class="fa fa-video-camera"></i>
        </a>
        <!-- edit -->
        <a ui-sref="users.user.detail.update({id: user.id })" os-perms="users.can_manage"
            class="btn btn-default btn-sm"
            title="{{ 'Edit' | translate}}">
          <i class="fa fa-pencil"></i>
        </a>
        <!-- delete -->
        <a ng-click="delete(user)" os-perms="users.can_manage" class="btn btn-danger btn-sm"
            title="{{ 'Delete' | translate }}">
          <i class="fa fa-trash-o"></i>
        </a>
</table>
