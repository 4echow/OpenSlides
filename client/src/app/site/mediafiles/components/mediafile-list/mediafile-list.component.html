<os-head-bar [mainButton]="true" (mainEvent)="onMainEvent()" [editMode]="editFile" (saveEvent)="onSaveEditedFile()">
    <!-- Title -->
    <div class="title-slot">
        <h2 *ngIf="!editFile" translate>Files</h2>

        <form
            class="edit-file-form"
            *ngIf="editFile"
            [formGroup]="fileEditForm"
            (ngSubmit)="onSaveEditedFile()"
            (keydown)="keyDownFunction($event)"
        >
            <mat-form-field>
                <input
                    type="text"
                    matInput
                    osAutofocus
                    required
                    formControlName="title"
                    placeholder="{{ 'New file name' | translate}}"
                />
                <mat-error *ngIf="fileEditForm.invalid" translate>Required</mat-error>
            </mat-form-field>

            <mat-form-field>
                <mat-select formControlName="hidden" placeholder="{{ 'Visibility' | translate}}">
                    <mat-option [value]="true"> <span translate>Hidden</span> </mat-option>
                    <mat-option [value]="false"><span translate>Visible</span></mat-option>
                </mat-select>
            </mat-form-field>
        </form>
    </div>

    <!-- Menu -->
    <div class="menu-slot">
        <button type="button" mat-icon-button [matMenuTriggerFor]="mediafilesMenu">
            <mat-icon>more_vert</mat-icon>
        </button>
    </div>
</os-head-bar>

<mat-table class="os-listview-table on-transition-fade" [dataSource]="dataSource" matSort>
    <!-- Filename -->
    <ng-container matColumnDef="title">
        <mat-header-cell *matHeaderCellDef mat-sort-header>Name</mat-header-cell>
        <mat-cell *matCellDef="let file" (click)="download(file)">{{ file.title }}</mat-cell>
    </ng-container>

    <!-- Info -->
    <ng-container matColumnDef="info">
        <mat-header-cell *matHeaderCellDef mat-sort-header>Group</mat-header-cell>
        <mat-cell *matCellDef="let file" (click)="download(file)">
            <div class="file-info-cell">
                <span> <mat-icon [inline]="true">insert_drive_file</mat-icon> {{ file.type }} </span>
                <span> <mat-icon [inline]="true">data_usage</mat-icon> {{ file.size }} </span>
            </div>
        </mat-cell>
    </ng-container>

    <!-- indicator -->
    <ng-container matColumnDef="indicator">
        <mat-header-cell *matHeaderCellDef mat-sort-header>Indicator</mat-header-cell>
        <mat-cell *matCellDef="let file">
            <!-- check if the file is managed -->

            <div
                *ngIf="getFileSettings(file).length > 0"
                [matMenuTriggerFor]="singleFileMenu"
                [matMenuTriggerData]="{ file: file }"
                [matTooltip]="formatIndicatorTooltip(file)"
            >
                <mat-icon *ngIf="file.isFont()">text_fields</mat-icon>
                <mat-icon *ngIf="file.isImage()">insert_photo</mat-icon>
            </div>
        </mat-cell>
    </ng-container>

    <!-- menu -->
    <ng-container matColumnDef="menu">
        <mat-header-cell *matHeaderCellDef mat-sort-header>Menu</mat-header-cell>
        <mat-cell *matCellDef="let file">
            <button mat-icon-button [matMenuTriggerFor]="singleFileMenu" [matMenuTriggerData]="{ file: file }">
                <mat-icon>more_vert</mat-icon>
            </button>
        </mat-cell>
    </ng-container>

    <mat-header-row *matHeaderRowDef="getColumnDefinition()"></mat-header-row>
    <mat-row *matRowDef="let row; columns: getColumnDefinition()"></mat-row>
</mat-table>

<mat-paginator class="on-transition-fade" [pageSizeOptions]="[25, 50, 75, 100, 125]"></mat-paginator>

<mat-menu #singleFileMenu="matMenu">
    <ng-template matMenuContent let-file="file">
        <!-- Exclusive for images -->
        <div *ngIf="file.isImage()">
            <div *ngFor="let action of logoActions">
                <ng-container *ngTemplateOutlet="manageButton; context: { file: file, action: action }"></ng-container>
            </div>
        </div>

        <!-- Exclusive for fonts -->
        <div *ngIf="file.isFont()">
            <div *ngFor="let action of fontActions">
                <ng-container *ngTemplateOutlet="manageButton; context: { file: file, action: action }"></ng-container>
            </div>
        </div>

        <!-- Edit and delete for all images -->
        <mat-divider></mat-divider>
        <button mat-menu-item (click)="onEditFile(file)">
            <mat-icon>edit</mat-icon>
            <span translate>Edit</span>
        </button>
        <button mat-menu-item class="red-warning-text" (click)="onDelete(file)">
            <mat-icon>delete</mat-icon>
            <span translate>Delete</span>
        </button>
    </ng-template>
</mat-menu>

<!-- Template for the managing buttons -->
<ng-template #manageButton let-file="file" let-action="action">
    <button mat-menu-item (click)="onManageButton($event, file, action)">
        <mat-icon color="accent"> {{ isUsedAs(file, action) ? 'check_box' : 'check_box_outline_blank' }} </mat-icon>
        <span>{{ getNameOfAction(action) }}</span>
    </button>
</ng-template>

<!-- Menu for Mediafiles -->
<mat-menu #mediafilesMenu="matMenu">
    <!-- Delete all files - later replaced with multi-select function -->
    <button mat-menu-item class="red-warning-text" (click)="onDeleteAllFiles()">
        <mat-icon>delete</mat-icon>
        <span translate>Delete all files</span>
    </button>
</mat-menu>
