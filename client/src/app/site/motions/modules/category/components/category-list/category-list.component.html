<os-head-bar prevUrl="../.." [nav]="false" [mainButton]="canEdit" (mainEvent)="onPlusButton()">
    <!-- Title -->
    <div class="title-slot">
        <h2 translate>Categories</h2>
    </div>

    <!-- Menu -->
    <div class="menu-slot" *osPerms="'motions.can_manage'">
        <button type="button" mat-icon-button [matMenuTriggerFor]="categoryMenu">
            <mat-icon>more_vert</mat-icon>
        </button>
    </div>
</os-head-bar>

<!-- Creating a new motion block -->
<mat-card class="os-card" *ngIf="isCreatingNewCategory">
    <mat-card-title translate>New motion block</mat-card-title>
    <mat-card-content>
        <form [formGroup]="createForm" (keydown)="onKeyDown($event)">
            <!-- Prefix -->
            <p>
                <mat-form-field>
                    <input formControlName="prefix" matInput placeholder="{{ 'Prefix' | translate }}" />
                </mat-form-field>
            </p>

            <!-- Name -->
            <p>
                <mat-form-field>
                    <input formControlName="name" matInput placeholder="{{ 'Name' | translate }}" required />
                    <mat-error *ngIf="!createForm.controls.name.valuid" translate>
                        A name is required
                    </mat-error>
                </mat-form-field>
            </p>
        </form>
    </mat-card-content>

    <!-- Save and Cancel buttons -->
    <mat-card-actions>
        <button mat-button [disabled]="!createForm.valid" (click)="onCreate()">
            <span translate>Save</span>
        </button>
        <button mat-button (click)="onCancel()">
            <span translate>Cancel</span>
        </button>
    </mat-card-actions>
</mat-card>

<!-- Table -->
<mat-card class="os-card">
    <table class="os-headed-listview-table on-transition-fade" mat-table [dataSource]="dataSource">
        <!-- title column -->
        <ng-container matColumnDef="title">
            <mat-header-cell *matHeaderCellDef>
                <span translate>Title</span>
            </mat-header-cell>
            <mat-cell *matCellDef="let category">
                <div [style.margin-left]="getMargin(category)">{{ category.prefixedName }}</div>
            </mat-cell>
        </ng-container>

        <!-- amount column -->
        <ng-container matColumnDef="amount">
            <mat-header-cell *matHeaderCellDef>
                <span translate>Motions</span>
            </mat-header-cell>
            <mat-cell *matCellDef="let category">
                <span class="os-amount-chip">{{ getMotionAmount(category) }}</span>
            </mat-cell>
        </ng-container>

        <!-- Anchor column to open the separate tab -->
        <ng-container matColumnDef="anchor">
            <mat-header-cell *matHeaderCellDef></mat-header-cell>
            <mat-cell *matCellDef="let category">
                <a [routerLink]="category.id"></a>
            </mat-cell>
        </ng-container>

        <mat-header-row *matHeaderRowDef="getColumnDefinition()"></mat-header-row>
        <mat-row *matRowDef="let row; columns: getColumnDefinition()"> </mat-row>
    </table>
</mat-card>

<mat-menu #categoryMenu="matMenu">
    <button mat-menu-item [routerLink]="'./sort'">
        <mat-icon>sort</mat-icon>
        <span translate>Sort categories</span>
    </button>
</mat-menu>
