<os-head-bar prevUrl="../.." [nav]="false" [mainButton]="canEdit" (mainEvent)="onPlusButton()">
    <!-- Title -->
    <div class="title-slot"><h2 translate>Motion blocks</h2></div>
</os-head-bar>

<!-- Creating a new motion block -->
<mat-card class="os-card" *ngIf="isCreatingNewBlock">
    <mat-card-title translate>New motion block</mat-card-title>
    <mat-card-content>
        <form [formGroup]="createBlockForm" (keydown)="onKeyDown($event)">
            <!-- Title -->
            <p>
                <mat-form-field>
                    <input formControlName="title" matInput placeholder="{{ 'Title' | translate }}" required />
                    <mat-error *ngIf="createBlockForm.get('title').hasError('required')" translate>
                        A title is required
                    </mat-error>
                </mat-form-field>
            </p>

            <!-- Internal -->
            <p>
                <mat-checkbox formControlName="internal"><span translate>Internal</span></mat-checkbox>
            </p>

            <!-- Parent item -->
            <p>
                <os-search-value-selector
                    ngDefaultControl
                    listname="{{ 'Parent agenda item' | translate }}"
                    [form]="createBlockForm"
                    [formControl]="createBlockForm.get('agenda_parent_id')"
                    [multiple]="false"
                    [includeNone]="true"
                    [InputListValues]="items"
                ></os-search-value-selector>
            </p>

            <!-- Visibility -->
            <mat-form-field>
                <mat-select formControlName="agenda_type" placeholder="{{ 'Agenda visibility' | translate }}">
                    <mat-option *ngFor="let type of itemVisibility" [value]="type.key">
                        <span>{{ type.name | translate }}</span>
                    </mat-option>
                </mat-select>
            </mat-form-field>
        </form>
    </mat-card-content>

    <!-- Save and Cancel buttons -->
    <mat-card-actions>
        <button mat-button [disabled]="!createBlockForm.valid" (click)="onSaveNewButton()">
            <span translate>Save</span>
        </button>
        <button mat-button (click)="onCancel()"><span translate>Cancel</span></button>
    </mat-card-actions>
</mat-card>

<mat-card class="os-card">
    <os-list-view-table
        [repo]="repo"
        [showFilterBar]="false"
        [columns]="tableColumnDefinition"
        [multiSelect]="isMultiSelect"
        scrollKey="motionBlock"
        [(selectedRows)]="selectedRows"
        (dataSourceChange)="onDataSourceChange($event)"
    >
        <!-- Title column -->
        <div *pblNgridCellDef="'title'; value as title; row as block; rowContext as rowContext" class="cell-slot fill">
            <a
                class="detail-link"
                (click)="saveScrollIndex('motionBlock', rowContext.identity)"
                [routerLink]="block.id"
                *ngIf="!isMultiSelect"
            ></a>
            <div>
                <mat-icon matTooltip="Internal" *ngIf="block.internal">lock</mat-icon>
                {{ title }}
            </div>
        </div>

        <!-- Amount -->
        <div *pblNgridCellDef="'amount'; row as block" class="cell-slot fill">
            <span class="os-amount-chip">{{ getMotionAmount(block.motionBlock) }}</span>
        </div>
    </os-list-view-table>
</mat-card>
